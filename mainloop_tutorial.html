<!DOCTYPE html>
<html>
<head>
	<title>loop_tutorial</title>
	<style type="text/css">
		#box {
			background-color: red;
			height: 50px;
			left: 150px;
			position: absolute;
			top: 10px;
			width: 50px;
		}
	</style>
</head>
<body>
	<div id="box"></div>

	<script type="text/javascript">
		var box = document.getElementById('box'),
		boxPos = 10,
		boxVelocity = 3,
		delta = 0; 
		limit = 300;
	
		var lastFrameTimeMs = 0, // The last time the loop was run
			maxFPS = 60; // Maximum FPS we want to allow

		var timestep = 1000 / 60;

		function draw() {
			box.style.left = boxPos + 'px';
		}

		function update(delta) {
			boxPos += boxVelocity * delta;
			// Swich directions if we go too far
			if (boxPos >= limit || boxPos <= 0) boxVelocity = -boxVelocity;
		}

		function panic() {
			delta = 0; // discard the undimulated time
			// ... snap the player to the authorative state
		}


		function mainLoop(timestamp) {
			// Throttle the frame rate.
			if (timestamp < lastFrameTimeMs + (1000 / maxFPS)) {
				requestAnimationFrame(mainLoop);
				return;
			} 
			delta += timestamp - lastFrameTimeMs; // get the delta time since last frame
			lastFrameTimeMs = timestamp;

			while (delta >= timestep) {
				update(timestep);
				delta -= timestep;
				// Sanity check
				if (++numUpdateSteps >= 240) {
					panic(); // fix things
					break; // bail out
				}
			}
			draw();
			requestAnimationFrame(mainLoop);

		}

		requestAnimationFrame(mainLoop);

		/*
		function mainLoop() {
			update();
			draw();
			requestAnimationFrame(mainLoop);
		}

		requestAnimationFrame(mainLoop)
		/*
		while (true) {
			update();
			draw();
		}
		*/
	</script>

</body>
</html>